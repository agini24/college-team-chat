<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>College Team Chat</title>
  <meta name="theme-color" content="#D10F2F">

  <style>
    body{margin:0;background:#0A0A0B;color:#fff;font-family:sans-serif}
    header{padding:10px 20px;background:#111214;color:#fff;display:flex;align-items:center;justify-content:space-between}
    h1{font-size:20px;margin:0}
    .tabs{display:flex;gap:10px}
    .tabs button{padding:8px 16px;border-radius:20px;border:none;background:#222;color:#bbb;cursor:pointer}
    .tabs button.active{background:#D10F2F;color:#fff}
    .pill{font-size:12px;color:#aaa}
    main{display:flex;gap:20px;padding:20px}
    .panel{background:#111214;padding:15px;border-radius:10px;flex:1}
    .field{margin-bottom:10px}
    label{display:block;font-size:12px;color:#aaa;margin-bottom:3px}
    input{width:100%;padding:8px;border-radius:6px;border:1px solid #333;background:#0B0C0E;color:#fff}
    button{padding:10px;border-radius:6px;border:none;background:#D10F2F;color:#fff;cursor:pointer}
    #chatMount{height:70vh;min-height:400px;border:1px solid #333;border-radius:10px;overflow:hidden}
  </style>
</head>
<body>
  <header>
    <h1>College Team Chat</h1>
    <div class="tabs">
      <button id="tabTeam" class="active">Team Chat</button>
      <button id="tabAnn">Coach Announcements</button>
      <button id="tabQna">Questions</button>
    </div>
    <span id="whoami" class="pill">Not logged in</span>
  </header>

  <main>
    <div class="panel" style="max-width:300px">
      <h3>Login</h3>
      <div class="field">
        <label>UID (e.g., p_john)</label>
        <input id="uidInput" />
      </div>
      <div class="field">
        <label>Display name</label>
        <input id="nameInput" />
      </div>
      <button id="doLogin">Log in now</button>
    </div>

    <div class="panel" style="flex:2">
      <h3>Chat</h3>
      <div id="chatMount"></div>
    </div>
  </main>

  <!-- CometChat Widget SDK -->
  <script src="https://widget-js.cometchat.io/v3/cometchatwidget.js"></script>
  <script>
    const CC_APP_ID  = "2808186f24275c0e";
    const CC_REGION  = "us";
    const CC_AUTHKEY = "d20ca03513ab3c8c65c84f3429e7fd84a0deeb34";

    const GROUP_TEAM = {id:"team_chat", name:"Team Chat"};
    const GROUP_ANN  = {id:"announcements", name:"Coach Announcements"};
    const GROUP_QNA  = {id:"questions", name:"Questions"};

    let activeGroup = GROUP_TEAM;

    const $ = s => document.querySelector(s);

    function setActiveTab(tab){
      $("#tabTeam").classList.toggle("active", tab==="team");
      $("#tabAnn").classList.toggle("active", tab==="ann");
      $("#tabQna").classList.toggle("active", tab==="qna");
    }

    async function openGroup(group){
      const CC = CometChatWidget.CometChat;
      try { await CC.getGroup(group.id); }
      catch { await CC.createGroup(new CC.Group(group.id, CC.GROUP_TYPE.PUBLIC, group.name)); }
      try { await CC.joinGroup(group.id, CC.GROUP_TYPE.PUBLIC, ""); } catch(e){}
      await CometChatWidget.launch({
        widgetID:"default",
        target:"#chatMount",
        roundedCorners:"true",
        height:"100%",
        width:"100%",
        defaultID:group.id,
        defaultType:"group"
      });
    }

    (async () => {
      await CometChatWidget.init({ appID:CC_APP_ID, appRegion:CC_REGION, authKey:CC_AUTHKEY });
    })();

    $("#doLogin").onclick = async () => {
      const uid = $("#uidInput").value.trim();
      const name = $("#nameInput").value.trim();
      if(!uid||!name) return alert("Enter UID and Name");
      try{ await CometChatWidget.login({uid}); }
      catch{ 
        await CometChatWidget.createOrUpdateUser({uid,name},CC_AUTHKEY);
        await CometChatWidget.login({uid}); 
      }
      $("#whoami").textContent = `Logged in as ${name} (${uid})`;
      openGroup(GROUP_TEAM);
    };

    $("#tabTeam").onclick = () => {setActiveTab("team"); openGroup(GROUP_TEAM);};
    $("#tabAnn").onclick  = () => {setActiveTab("ann"); openGroup(GROUP_ANN);};
    $("#tabQna").onclick  = () => {setActiveTab("qna"); openGroup(GROUP_QNA);};
  </script>
</body>
</html>
